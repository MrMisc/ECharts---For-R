jsonfile<-'{
    "color": [
        "#ff8a5f",
        "#00917c",
        "#136574",
        "#7775da",
        "#4f4538",
        "#8f1300",
        "#7fd1ae",
        "#803eb1",
        "#724e58",
        "#d58cff"
    ],
    "backgroundColor": "#fff6eb",
    "textStyle": {},
    "title": {
        "textStyle": {
            "color": "#333333"
        },
        "subtextStyle": {
            "color": "#aaaaaa"
        }
    },
    "line": {
        "itemStyle": {
            "borderWidth": 1
        },
        "lineStyle": {
            "width": 2
        },
        "symbolSize": 4,
        "symbol": "emptyCircle",
        "smooth": false
    },
    "radar": {
        "itemStyle": {
            "borderWidth": 1
        },
        "lineStyle": {
            "width": 2
        },
        "symbolSize": 4,
        "symbol": "emptyCircle",
        "smooth": false
    },
    "bar": {
        "itemStyle": {
            "barBorderWidth": 0,
            "barBorderColor": "#ccc"
        }
    },
    "pie": {
        "itemStyle": {
            "borderWidth": 0,
            "borderColor": "#ccc"
        }
    },
    "scatter": {
        "itemStyle": {
            "borderWidth": 0,
            "borderColor": "#ccc"
        }
    },
    "boxplot": {
        "itemStyle": {
            "borderWidth": 0,
            "borderColor": "#ccc"
        }
    },
    "parallel": {
        "itemStyle": {
            "borderWidth": 0,
            "borderColor": "#ccc"
        }
    },
    "sankey": {
        "itemStyle": {
            "borderWidth": 0,
            "borderColor": "#ccc"
        }
    },
    "funnel": {
        "itemStyle": {
            "borderWidth": 0,
            "borderColor": "#ccc"
        }
    },
    "gauge": {
        "itemStyle": {
            "borderWidth": 0,
            "borderColor": "#ccc"
        }
    },
    "candlestick": {
        "itemStyle": {
            "color": "#c23531",
            "color0": "#314656",
            "borderColor": "#c23531",
            "borderColor0": "#314656",
            "borderWidth": 1
        }
    },
    "graph": {
        "itemStyle": {
            "borderWidth": 0,
            "borderColor": "#ccc"
        },
        "lineStyle": {
            "width": 1,
            "color": "#aaaaaa"
        },
        "symbolSize": 4,
        "symbol": "emptyCircle",
        "smooth": false,
        "color": [
            "#ff8a5f",
            "#00917c",
            "#136574",
            "#7775da",
            "#4f4538",
            "#8f1300",
            "#7fd1ae",
            "#803eb1",
            "#724e58",
            "#d58cff"
        ],
        "label": {
            "color": "#eeeeee"
        }
    },
    "map": {
        "itemStyle": {
            "areaColor": "#eeeeee",
            "borderColor": "#444444",
            "borderWidth": 0.5
        },
        "label": {
            "color": "#000000"
        },
        "emphasis": {
            "itemStyle": {
                "areaColor": "rgba(255,215,0,0.8)",
                "borderColor": "#444444",
                "borderWidth": 1
            },
            "label": {
                "color": "rgb(100,0,0)"
            }
        }
    },
    "geo": {
        "itemStyle": {
            "areaColor": "#eeeeee",
            "borderColor": "#444444",
            "borderWidth": 0.5
        },
        "label": {
            "color": "#000000"
        },
        "emphasis": {
            "itemStyle": {
                "areaColor": "rgba(255,215,0,0.8)",
                "borderColor": "#444444",
                "borderWidth": 1
            },
            "label": {
                "color": "rgb(100,0,0)"
            }
        }
    },
    "categoryAxis": {
        "axisLine": {
            "show": true,
            "lineStyle": {
                "color": "#333"
            }
        },
        "axisTick": {
            "show": true,
            "lineStyle": {
                "color": "#333"
            }
        },
        "axisLabel": {
            "show": true,
            "color": "#333"
        },
        "splitLine": {
            "show": false,
            "lineStyle": {
                "color": [
                    "#ccc"
                ]
            }
        },
        "splitArea": {
            "show": false,
            "areaStyle": {
                "color": [
                    "rgba(250,250,250,0.3)",
                    "rgba(200,200,200,0.3)"
                ]
            }
        }
    },
    "valueAxis": {
        "axisLine": {
            "show": true,
            "lineStyle": {
                "color": "#333"
            }
        },
        "axisTick": {
            "show": true,
            "lineStyle": {
                "color": "#333"
            }
        },
        "axisLabel": {
            "show": true,
            "color": "#333"
        },
        "splitLine": {
            "show": true,
            "lineStyle": {
                "color": [
                    "#ccc"
                ]
            }
        },
        "splitArea": {
            "show": false,
            "areaStyle": {
                "color": [
                    "rgba(250,250,250,0.3)",
                    "rgba(200,200,200,0.3)"
                ]
            }
        }
    },
    "logAxis": {
        "axisLine": {
            "show": true,
            "lineStyle": {
                "color": "#333"
            }
        },
        "axisTick": {
            "show": true,
            "lineStyle": {
                "color": "#333"
            }
        },
        "axisLabel": {
            "show": true,
            "color": "#333"
        },
        "splitLine": {
            "show": true,
            "lineStyle": {
                "color": [
                    "#ccc"
                ]
            }
        },
        "splitArea": {
            "show": false,
            "areaStyle": {
                "color": [
                    "rgba(250,250,250,0.3)",
                    "rgba(200,200,200,0.3)"
                ]
            }
        }
    },
    "timeAxis": {
        "axisLine": {
            "show": true,
            "lineStyle": {
                "color": "#333"
            }
        },
        "axisTick": {
            "show": true,
            "lineStyle": {
                "color": "#333"
            }
        },
        "axisLabel": {
            "show": true,
            "color": "#333"
        },
        "splitLine": {
            "show": true,
            "lineStyle": {
                "color": [
                    "#ccc"
                ]
            }
        },
        "splitArea": {
            "show": false,
            "areaStyle": {
                "color": [
                    "rgba(250,250,250,0.3)",
                    "rgba(200,200,200,0.3)"
                ]
            }
        }
    },
    "toolbox": {
        "iconStyle": {
            "borderColor": "#999999"
        },
        "emphasis": {
            "iconStyle": {
                "borderColor": "#666666"
            }
        }
    },
    "legend": {
        "textStyle": {
            "color": "#333333"
        }
    },
    "tooltip": {
        "axisPointer": {
            "lineStyle": {
                "color": "#cccccc",
                "width": 1
            },
            "crossStyle": {
                "color": "#cccccc",
                "width": 1
            }
        }
    },
    "timeline": {
        "lineStyle": {
            "color": "#293c55",
            "width": 1
        },
        "itemStyle": {
            "color": "#293c55",
            "borderWidth": 1
        },
        "controlStyle": {
            "color": "#293c55",
            "borderColor": "#293c55",
            "borderWidth": 0.5
        },
        "checkpointStyle": {
            "color": "#e43c59",
            "borderColor": "#c23531"
        },
        "label": {
            "color": "#293c55"
        },
        "emphasis": {
            "itemStyle": {
                "color": "#a9334c"
            },
            "controlStyle": {
                "color": "#293c55",
                "borderColor": "#293c55",
                "borderWidth": 0.5
            },
            "label": {
                "color": "#293c55"
            }
        }
    },
    "visualMap": {
        "color": [
            "#bf444c",
            "#d88273",
            "#f6efa6"
        ]
    },
    "dataZoom": {
        "backgroundColor": "rgba(47,69,84,0)",
        "dataBackgroundColor": "rgba(47,69,84,0.3)",
        "fillerColor": "rgba(167,183,204,0.4)",
        "handleColor": "#a7b7cc",
        "handleSize": "100%",
        "textStyle": {
            "color": "#333333"
        }
    },
    "markPoint": {
        "label": {
            "color": "#eeeeee"
        },
        "emphasis": {
            "label": {
                "color": "#eeeeee"
            }
        }
    }
}'



westeros<-'{
    "version": 1,
    "themeName": "westeros",
    "theme": {
        "seriesCnt": "4",
        "backgroundColor": "rgba(0,0,0,0)",
        "titleColor": "#516b91",
        "subtitleColor": "#93b7e3",
        "textColorShow": false,
        "textColor": "#333",
        "markTextColor": "#eeeeee",
        "color": [
            "#516b91",
            "#59c4e6",
            "#edafda",
            "#93b7e3",
            "#a5e7f0",
            "#cbb0e3"
        ],
        "borderColor": "#ccc",
        "borderWidth": 0,
        "visualMapColor": [
            "#516b91",
            "#59c4e6",
            "#a5e7f0"
        ],
        "legendTextColor": "#999999",
        "kColor": "#edafda",
        "kColor0": "transparent",
        "kBorderColor": "#d680bc",
        "kBorderColor0": "#8fd3e8",
        "kBorderWidth": "2",
        "lineWidth": "2",
        "symbolSize": "6",
        "symbol": "emptyCircle",
        "symbolBorderWidth": "2",
        "lineSmooth": true,
        "graphLineWidth": 1,
        "graphLineColor": "#aaaaaa",
        "mapLabelColor": "#000",
        "mapLabelColorE": "#516b91",
        "mapBorderColor": "#516b91",
        "mapBorderColorE": "#516b91",
        "mapBorderWidth": 0.5,
        "mapBorderWidthE": 1,
        "mapAreaColor": "#f3f3f3",
        "mapAreaColorE": "#a5e7f0",
        "axes": [
            {
                "type": "all",
                "name": "通用坐标轴",
                "axisLineShow": true,
                "axisLineColor": "#cccccc",
                "axisTickShow": false,
                "axisTickColor": "#333",
                "axisLabelShow": true,
                "axisLabelColor": "#999999",
                "splitLineShow": true,
                "splitLineColor": [
                    "#eeeeee"
                ],
                "splitAreaShow": false,
                "splitAreaColor": [
                    "rgba(250,250,250,0.05)",
                    "rgba(200,200,200,0.02)"
                ]
            },
            {
                "type": "category",
                "name": "类目坐标轴",
                "axisLineShow": true,
                "axisLineColor": "#333",
                "axisTickShow": true,
                "axisTickColor": "#333",
                "axisLabelShow": true,
                "axisLabelColor": "#333",
                "splitLineShow": false,
                "splitLineColor": [
                    "#ccc"
                ],
                "splitAreaShow": false,
                "splitAreaColor": [
                    "rgba(250,250,250,0.3)",
                    "rgba(200,200,200,0.3)"
                ]
            },
            {
                "type": "value",
                "name": "数值坐标轴",
                "axisLineShow": true,
                "axisLineColor": "#333",
                "axisTickShow": true,
                "axisTickColor": "#333",
                "axisLabelShow": true,
                "axisLabelColor": "#333",
                "splitLineShow": true,
                "splitLineColor": [
                    "#ccc"
                ],
                "splitAreaShow": false,
                "splitAreaColor": [
                    "rgba(250,250,250,0.3)",
                    "rgba(200,200,200,0.3)"
                ]
            },
            {
                "type": "log",
                "name": "对数坐标轴",
                "axisLineShow": true,
                "axisLineColor": "#333",
                "axisTickShow": true,
                "axisTickColor": "#333",
                "axisLabelShow": true,
                "axisLabelColor": "#333",
                "splitLineShow": true,
                "splitLineColor": [
                    "#ccc"
                ],
                "splitAreaShow": false,
                "splitAreaColor": [
                    "rgba(250,250,250,0.3)",
                    "rgba(200,200,200,0.3)"
                ]
            },
            {
                "type": "time",
                "name": "时间坐标轴",
                "axisLineShow": true,
                "axisLineColor": "#333",
                "axisTickShow": true,
                "axisTickColor": "#333",
                "axisLabelShow": true,
                "axisLabelColor": "#333",
                "splitLineShow": true,
                "splitLineColor": [
                    "#ccc"
                ],
                "splitAreaShow": false,
                "splitAreaColor": [
                    "rgba(250,250,250,0.3)",
                    "rgba(200,200,200,0.3)"
                ]
            }
        ],
        "axisSeperateSetting": false,
        "toolboxColor": "#999999",
        "toolboxEmphasisColor": "#666666",
        "tooltipAxisColor": "#cccccc",
        "tooltipAxisWidth": 1,
        "timelineLineColor": "#8fd3e8",
        "timelineLineWidth": 1,
        "timelineItemColor": "#8fd3e8",
        "timelineItemColorE": "#8fd3e8",
        "timelineCheckColor": "#8fd3e8",
        "timelineCheckBorderColor": "#8a7ca8",
        "timelineItemBorderWidth": 1,
        "timelineControlColor": "#8fd3e8",
        "timelineControlBorderColor": "#8fd3e8",
        "timelineControlBorderWidth": 0.5,
        "timelineLabelColor": "#8fd3e8",
        "datazoomBackgroundColor": "rgba(0,0,0,0)",
        "datazoomDataColor": "rgba(255,255,255,0.3)",
        "datazoomFillColor": "rgba(167,183,204,0.4)",
        "datazoomHandleColor": "#a7b7cc",
        "datazoomHandleWidth": "100",
        "datazoomLabelColor": "#333"
    }
}'


remotes::install_github('helgasoft/echarty')  # get latest

library(rjson)
library(echarty); library(dplyr)
setwd("E:")
input <- read.csv("DirectExample.csv")
input |> mutate(
  vleth= scales::rescale(lethality, to = c(0.01,100.00)),
  sleth= scales::rescale(n, to = c(13,36)),
  pleth= lethality *100
) |> na.omit() |>
  group_by(Year) |> 
  ec.init(load= 'world', geo= list(roam=T), animation=F,
          tl.series= list(type='scatter', coordinateSystem='geo',
                          name= "reports",
                          encode= list(lng='lon', lat='lat'), symbolSize= ec.clmn('sleth') ),
          visualMap = list(dimension='vleth',
                           inRange = list(symbol = "diamond", bottom= 3, color= c('#6EA5FF','#DB2D12'),colorLightness = c(0.7,0.45), colorSaturation = c(10,300)) ),
          options= list(legend= list(show=T)),
          title = list(list(left="80%", top="1%", textStyle=list(fontSize=30, color='#11111166')), 
                       list(text = "Life expectancy and GDP by year", 
                            left = "10%", top = 10, textStyle = list(fontWeight = "normal", fontSize = 20))),
          tooltip= list(formatter= 
                          ec.clmn('%@<br>Number of Outbreak Incidents: %@<br />Lethality: %R@%', 'Country','n','pleth'))
  ) |> ec.theme("something",code = jsonfile)

# ----------------------------------
set.seed(444); N<- 300
df <- data.frame(x = runif(N,1,20),
                 y = runif(N,10,25),
                 z = rnorm(N,100,50),
                 Time = runif(N,5,500),
                 label = sample(c("interaction1", "interaction2", "interaction3", "interaction4", "interaction5"), N, replace = TRUE),
                 zone = sample(c("zone0", "zone1", "zone3"), N, replace = TRUE))
df_toadd<-data.frame(x = runif(N,80,100),
                     y = runif(N,10,25),
                     z = rnorm(N,100,50),
                     Time = runif(N,5,500),
                     label = sample(c("interaction1", "interaction2", "interaction3", "interaction4", "interaction5"), N, replace = TRUE),
                     zone = sample(c("zone0", "zone1", "zone3"), N, replace = TRUE))
df<-rbind(df,df_toadd)

df |> group_by(zone) |>  arrange(label) |> 
  ec.init(load='3D', tooltip= list(show= T),
          tl.series= list(type= 'scatter3D', groupBy= 'label'),
          visualMap= list(dimension=4, inRange= list(symbol= "diamond", symbolSize = c(35,5)))
          ,options= list(title= NULL)  # disable preset title
  )





remotes::install_github('helgasoft/echarty', force = TRUE)
library(echarty)
library(dplyr)
setwd("E:")
input<-read.csv("DirectExample.csv")

listofcountries<-c("Japan","Korea","Cambodia","Bangladesh","Uzbekistan","New Caledonia","Fiji","Ireland","Denmark","Latvia","Estonia","Portugal","W. Sahara","Puerto Rico","Honduras","Papua New Guinea","New Zealand","Norway","Iceland","Greenland","Cuba","Venezuela","Panama","Algeria","Libya","Egypt","Mauritania", "Saudi Arabia", "Yemen", "Oman","Thailand","Malaysia")
input<-rbind(input,data.frame(Country =listofcountries ,Year = rep(2005,length(listofcountries)),n = rep(0,length(listofcountries)), Deaths = rep(0,length(listofcountries)) , Cases = rep(0,length(listofcountries)), lethality = rep(0,length(listofcountries)), database_name = listofcountries, lat = rep(0,length(listofcountries)), lon = rep(0,length(listofcountries))))

all_years <- data.frame(Year = unique(input$Year))
all_countries <- data.frame(Country = unique(input$Country))

template <- expand.grid(Year = all_years$Year, Country = all_countries$Country)

# Merge the template dataset with the original dataset
filled_data <- merge(template, input, by = c("Year", "Country"), all = TRUE)
filled_data[is.na(filled_data)] <- 0  # Replace NA values with 0

filled_data %>%
  mutate(
    pleth = lethality * 100,
    Country = case_when(
      Country == 'Türkiye' ~ 'Turkey',
      Country == "China (People's Rep. of)" ~ "China",
      Country == "Congo (Dem. Rep. of the)" ~ "Dem. Rep. Congo",
      Country == "United States of America" ~ "United States",
      Country == "South Sudan (Rep. of)" ~ "S. Sudan",
      Country == "Cote D'Ivoire" ~ "Côte d'Ivoire",
      TRUE ~ Country
    )
  ) %>% na.omit() |>
  group_by(Year) |>
  
  ec.init(load= 'world', geo= list(roam=T), animation=F,
          tl.series= list( type= 'map', encode= list(name= 'Country', value= 'n') ),
          visualMap = list( text='n',
                            inRange = list(bottom= 3, color= c('#00DDF5','#A793FF','#DB2D12'), colorLightness = c(0.9,0.45), colorSaturation = c(100,300)) ),
          tooltip= list(formatter= ec.clmn('%@<br>Outbreak Incidents: %@<br />Lethality: %R@%', 'name', 'value', 'pleth')),
          title = list(list(left="80%", top="1%", textStyle=list(fontSize=30, color='#11111166')), 
                       list(text = "Outbreak incidents by year", 
                            left = "10%", top = 10, textStyle = list(fontWeight = "normal", fontSize = 20)))
  ) |> ec.theme("something", westeros)



thing<-input %>%
  mutate(
    pleth = lethality * 100,
    Country = case_when(
      Country == 'Türkiye' ~ 'Turkey',
      Country == "China (People's Rep. of)" ~ "China",
      TRUE ~ Country
    )
  )


